doctype 5
html(lang="en", ng-app="FFMachine", ng-controller="MachineSimulatorCtrl")
  head
    title(ng:bind-template="{{machine.name}}") Flip Flop Machine
    meta(charset="utf-8")

    link(href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0-rc2/css/bootstrap.min.css", rel="stylesheet", type="text/css")
    link(href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css", rel="stylesheet")
    link(href="http://fonts.googleapis.com/css?family=Abel|Open+Sans|Orbitron:400,600,900", rel="stylesheet")
    link(href="css/app.css", rel="stylesheet")
    link(href="css/machine.css", rel="stylesheet")

    script(src="https://cdn.firebase.com/v0/firebase.js")
    script(src="https://cdn.firebase.com/v0/firebase-simple-login.js")
    script(src="https://login.persona.org/include.js")
    script(src="//cdnjs.cloudflare.com/ajax/libs/d3/3.2.2/d3.v3.min.js")
    script(src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.1.5/angular.min.js")
    script(src="//cdn.firebase.com/libs/angularfire/0.3.0/angularfire.min.js")
    script(src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min.js")

    script(src="machine.js")
    script(src="modules.js")
    script(src="simulator-app.js")
    script(src="simulator.js")

  body(ng-class="{'edit-mode': mode == 'edit', 'simulation-mode': mode == 'simulate'}")
    include partials/toolbar
      .btn-group
        button.icon-book.icon-large.btn.btn-default(href=".") &nbsp;Directory
      .btn-group
        //- button.icon-home.btn.btn-default(href=".") &nbsp;Home
        button.icon-eye-open.icon-large.btn.btn-default(ng-hide="editable", ng-disabled="mode == 'view'", ng-click="mode = 'view'") &nbsp;View
        button.icon-wrench.icon-large.btn.btn-default(ng-show="editable", ng-disabled="mode == 'edit'", ng-show="editable", ng-click="mode = 'edit'") &nbsp;Edit
        button.icon-bolt.icon-large.btn.btn-default(ng-disabled="mode == 'simulate'", ng-click="mode = 'simulate'") &nbsp;Simulate
      .btn-group
        button.icon-step-forward.icon-large.btn.btn-default(ng-disabled="simulatonRunning", ng-click="stepSimulation()", title="Click to step the simulation")
        button.icon-play.icon-large.btn.btn-default(ng-disabled="simulationRunning", ng-click="runSimulation()", title="Click to start the simulation")
        button.icon-pause.icon-large.btn.btn-default(ng-disabled="!simulationRunning", ng-click="stopSimulation()", title="Click to pause the simulation")
        //- a.icon-pause.btn.btn-default(ng-show="mode == 'simulate'", ng-disabled="!simulaton_running")
      h1.machine-name {{machine.name || 'Loadingâ€¦'}}

    .content

      .col-md-8
        #frame.frame
          .ffmachine
            img(src="img/ffmachine.png", width=900, height=1000)
            svg#wirebuffer
              defs
                filter#drop-shadow
                  feGaussianBlur(in="SourceAlpha", result="blur", stdDeviation="2")
                  feOffset(in="blur", dx=4, dy=4, result="offsetBlur")
                  feBlend(in2="offsetBlur", in="SourceGraphic", mode="normal")
                filter#drop-shadow-2
                  feGaussianBlur(in="SourceAlpha", result="blur", stdDeviation="1")
                  feOffset(in="blur", dx=4, dy=4, result="offsetBlur")
                  feBlend(in2="offsetBlur", in="SourceGraphic", mode="normal")
                linearGradient#grad1(x1="0%", y1="0%", x2="100%", y2="0%")
                  stop(offset="0%", style="stop-color:rgb(255,255,0);stop-opacity:1")
                  stop(offset="100%", style="stop-color:rgb(255,0,0);stop-opacity:1")

      #sidebar.col-md-4
        .panel.panel-default(ng-show="mode != 'simulate' && machine.description")
          .panel-heading {{machine.description}}
          .panel-body
            {{machine.description}}

        #trace.panel.panel-default(ng-show="mode == 'simulate'")
          .panel-heading Trace
          .panel-body
            svg#wireTrace(width=400, height=200)

        #connected-users.panel.panel-default(ng-show="machine.connected")
          .panel-heading Current Viewers
          .panel-body
            ul
              li(ng-repeat="viewer in machine.connected") {{viewer}}

        #legend.panel.panel-default(ng-show="mode == 'simulate'")
          .panel-heading Legend
          .panel-body
            .negative-voltage -3V
            .ground-voltage 0V
          //- .pull-right.float-voltage undefined
